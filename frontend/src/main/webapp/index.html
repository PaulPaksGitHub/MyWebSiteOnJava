<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Hello World</title>

	<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
	
	<script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
	<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
</head>
<body>

<div id="form"></div>
<div id="users"></div>

<script type="text/babel">

function handleClick(props) {
	console.log('---','clicked')
	this.setState({
		isOpen: !this.state.isOpen
	})
	const {userid} = props
	console.log('---',{userid})
}

class UserClick extends React.Component {
	constructor(props) {
		super(props);
		this.state = {
			tableOpen: false
		};
		this.clicked = this.clicked.bind(this)
	}
	clicked() {
		console.log('---','clicked')
		this.setState({tableOpen : !this.state.tableOpen });
	}
	render() {
		const {userid} = this.props
		if (this.state.tableOpen === true){
			return (
			<div>
				<button onClick={this.clicked}>Close</button>
				<AutorityTable userid={userid}/>
			</div>
			);
		} else {
			return <button onClick={this.clicked}>Select {userid}</button>
		}
	}
}

class AutorClick extends React.Component {
	constructor(props) {
		super(props);
		this.state = {
			tableOpen: false
		};
		this.clicked = this.clicked.bind(this)
	}
	clicked() {
		console.log('---','clicked')
		this.setState({tableOpen : !this.state.tableOpen });
	}
	render() {
		const {autorityid} = this.props
		if (this.state.tableOpen === true){
			return (
			<div>
				<button onClick={this.clicked}>Close</button>
				<ActivityTable autorityid={autorityid}/>
			</div>
			);
		} else {
			return <button onClick={this.clicked}>Select {autorityid}</button>
		}
	}
}

class UserTable extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      error: null,
      isLoaded: false,
      items: [],
	  isOpen: true
    };
	
	this.handleClick = handleClick.bind(this)
  }

  componentWillMount() {
    fetch("ajax/user")
      .then(res => res.json())
      .then(
        (result) => {
          this.setState({
            isLoaded: true,
            items: result.items
          });
        },
        (error) => {
          this.setState({
            isLoaded: false,
            error
          });
        }
      )
  }

  render() {
    const { error, isLoaded, items } = this.state;
	console.log('items',items);
    if (error) {
      return <div>Error: {error.message}</div>;
    } else if (this.state.isOpen === true) {
		return (
        <table className="table" >
                <thead>
                    <tr>
                        <th>
                            id
                    </th>
                    <th>
                        login
                   </th>
                    <th>
                        version
                    </th>
                </tr>
        </thead>
        <tbody>
            {items.map(item => {
                return (
                    <tr key={item.id}>
                        <td>{item.id}</td>
                        <td>{item.login}</td>
                        <td>{item.version}</td>
						<UserClick userid={item.id}/>
                        </tr>
                    );
                })
            }
        </tbody>
    </table>
      );
	}
    else {
      return (
        <div/>
      );
    }
  }
}

class AutorityTable extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      error: null,
      isLoaded: false,
      items: [],
	  isOpen: true,
    };
	
	this.handleClick = handleClick.bind(this)
  }

  componentWillMount() {
	const {userid} = this.props
    fetch("ajax/authority?userid="+userid)
      .then(res => res.json())
      .then(
        (result) => {
          this.setState({
            isLoaded: true,
            items: result.items
          });
        },
        (error) => {
          this.setState({
            isLoaded: false,
            error
          });
        }
      )
  }

  render() {
    const { error, isLoaded, items } = this.state;
    if (error) {
      return <div>Error: {error.message}</div>;
    } else if (this.state.isOpen === true) {
		return (
        <table className="table" >
			<thead>
				<tr>
					<th>
						id
                    </th>
                    <th>
                        version
                    </th>
					<th>
                        adress
                    </th>
					<th>
                        role
                    </th>
                </tr>
			</thead>
        <tbody>
            {items.map(item => {
                return (
                    <tr key={item.id}>
                        <td>{item.id}</td>
                        <td>{item.version}</td>
						<td>{item.adress}</td>
						<td>{item.role}</td>
						<AutorClick autorityid={item.role}/>
                        </tr>
                    );
                })
            }
        </tbody>
    </table>
      );
	}
    else {
      return (
        <div/>
      );
    }
  }
}

class ActivityTable extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      error: null,
      isLoaded: false,
      items: [],
	  isOpen: true,
	  autorityid: 'READ'
    };
	
	this.handleClick = handleClick.bind(this)
  }

  componentWillMount() {
	const {autorityid} = this.props
    fetch("ajax/activity?autorityid="+autorityid)
      .then(res => res.json())
      .then(
        (result) => {
          this.setState({
            isLoaded: true,
            items: result.items
          });
        },
        (error) => {
          this.setState({
            isLoaded: false,
            error
          });
        }
      )
  }

  render() {
    const { error, isLoaded, items } = this.state;
    if (error) {
      return <div>Error: {error.message}</div>;
    } else if (this.state.isOpen === true) {
		return (
        <table className="table" >
			<thead>
				<tr>
					<th>
						id
                    </th>
                    <th>
                        version
                    </th>
                    <th>
                        ds
                    </th>
					<th>
                        de
                    </th>
					<th>
                        vol
                    </th>
                </tr>
        </thead>
        <tbody>
            {items.map(item => {
                return (
                    <tr key={item.id}>
                        <td>{item.id}</td>
                        <td>{item.version}</td>
                        <td>{item.ds}</td>
                        <td>{item.de}</td>
                        <td>{item.vol}</td>
                        </tr>
                    );
                })
            }
        </tbody>
    </table>
      );
	}
    else {
      return (
        <div/>
      );
    }
  }
}

class Main extends React.Component {
	render() {
		return (
		<div>
			<UserTable />
		</div>
		);
	}
}

ReactDOM.render(
	<Main />, document.getElementById('users')
);

class Form extends React.Component {
	constructor(props) {
    super(props); }
	
	render () {
		return (
			<form method="post" action="ajax/activity">
				<li>Post servlet:</li><br/>
				<li>Login<input type="text" id="1" name="login" /></li><br/>
				<li>Password<input type="text" id="2" name="pass" /></li><br/>
				<li>Role<input type="text" id="3" name="role" /></li><br/>
				<li>Resource<input type="text" id="4" name="res" /></li><br/>
				<li>Data Start<input type="text" id="5" name="ds" /></li><br/>
				<li>Data End<input type="text" id="6" name="de" /></li><br/>
				<li>Volume<input type="text" id="7" name="vol" /></li><br/>
				<input type="submit" id="say-hello-button" value="submit" />
			</form>
		)
	}
}

ReactDOM.render(
	<Form />, document.getElementById('form')
);
</script

</body>
</html>