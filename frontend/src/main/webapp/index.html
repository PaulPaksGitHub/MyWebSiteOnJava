<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Hello World</title>
	<script src="https://unpkg.com/react@16/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>

<div id="users"></div>
<div id="autority"></div>

<script type="text/babel">

function handleClick() {
	console.log('---','clicked')
	this.setState({
		isOpen: !this.state.isOpen
	})
	console.log('---',this.state.isOpen)
}

class UserTable extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      error: null,
      isLoaded: false,
      items: [],
	  isOpen: true
    };
	
	this.handleClick = handleClick.bind(this)
  }

  componentWillMount() {
    fetch("ajax/user")
      .then(res => res.json())
      .then(
        (result) => {
          this.setState({
            isLoaded: true,
            items: result.items
          });
        },
        (error) => {
          this.setState({
            isLoaded: false,
            error
          });
        }
      )
  }

  render() {
    const { error, isLoaded, items } = this.state;
    if (error) {
      return <div>Error: {error.message}</div>;
    } else if (this.state.isOpen === true) {
		return (
        <table className="table" >
                <thead>
                    <tr>
                        <th>
                            id
                    </th>
                    <th>
                        login
                   </th>
                    <th>
                        version
                    </th>
                </tr>
        </thead>
        <tbody>
            {items.map(item => {
                return (
                    <tr key={item.id}>
                        <td>{item.id}</td>
                        <td>{item.login}</td>
                        <td>{item.version}</td>
						<button onClick={this.handleClick}>select</button>
                        </tr>
                    );
                })
            }
        </tbody>
    </table>
      );
	}
    else {
      return (
        <div/>
      );
    }
  }
}

class AutorityTable extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      error: null,
      isLoaded: false,
      items: [],
	  isOpen: true,
	  userid: 1
    };
	
	this.handleClick = handleClick.bind(this)
  }

  componentWillMount() {
    fetch("ajax/authority?userid="+this.state.userid)
      .then(res => res.json())
      .then(
        (result) => {
          this.setState({
            isLoaded: true,
            items: result.items
          });
        },
        (error) => {
          this.setState({
            isLoaded: false,
            error
          });
        }
      )
  }

  render() {
    const { error, isLoaded, items } = this.state;
    if (error) {
      return <div>Error: {error.message}</div>;
    } else if (this.state.isOpen === true) {
		return (
        <table className="table" >
			<thead>
				<tr>
					<th>
						id
                    </th>
                    <th>
                        version
                    </th>
					<th>
                        adress
                    </th>
					<th>
                        role
                    </th>
                </tr>
			</thead>
        <tbody>
            {items.map(item => {
                return (
                    <tr key={item.id}>
                        <td>{item.id}</td>
                        <td>{item.version}</td>
						<td>{item.adress}</td>
						<td>{item.role}</td>
						<button onClick={this.handleClick}>select</button>
                        </tr>
                    );
                })
            }
        </tbody>
    </table>
      );
	}
    else {
      return (
        <div/>
      );
    }
  }
}

class ActivityTable extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      error: null,
      isLoaded: false,
      items: [],
	  isOpen: true,
	  autorityid: 'READ'
    };
	
	this.handleClick = handleClick.bind(this)
  }

  componentWillMount() {
    fetch("ajax/activity?autorityid="+this.state.autorityid)
      .then(res => res.json())
      .then(
        (result) => {
          this.setState({
            isLoaded: true,
            items: result.items
          });
        },
        (error) => {
          this.setState({
            isLoaded: false,
            error
          });
        }
      )
  }

  render() {
    const { error, isLoaded, items } = this.state;
    if (error) {
      return <div>Error: {error.message}</div>;
    } else if (this.state.isOpen === true) {
		return (
        <table className="table" >
			<thead>
				<tr>
					<th>
						id
                    </th>
                    <th>
                        version
                    </th>
                    <th>
                        ds
                    </th>
					<th>
                        de
                    </th>
					<th>
                        vol
                    </th>
                </tr>
        </thead>
        <tbody>
            {items.map(item => {
                return (
                    <tr key={item.id}>
                        <td>{item.id}</td>
                        <td>{item.version}</td>
                        <td>{item.ds}</td>
                        <td>{item.de}</td>
                        <td>{item.vol}</td>
                        </tr>
                    );
                })
            }
        </tbody>
    </table>
      );
	}
    else {
      return (
        <div/>
      );
    }
  }
}

class Main extends React.Component {
	render() {
		return (
		<div>
			<UserTable />
			<AutorityTable />
			<ActivityTable />
		</div>
		)
	}
}

ReactDOM.render(
	<Main />, document.getElementById('users')
);
</script

</body>
</html>